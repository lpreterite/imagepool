!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Imagepool=e()}(this,function(){function t(t){this.max=t||n.thread,this.linkHead=null,this.linkNode=null,this.pool=[]}var e=null,o=function(){},n={thread:5,try:2},i={setAttr:function(){var t=new Image;return t.dataset?function(t,e,o){return t.dataset[e]=o,o}:function(t,e,o){return t.setAttribute("data-"+e,o),o}}(),getAttr:function(){var t=new Image;return t.dataset?function(t,e){return t.dataset[e]}:function(t,e){return t.getAttribute("data-"+e)}}()};return t.prototype.initPool=function(){var t,e,o,r;for(r=this,t=0;t<this.max;t++)o={},e=new Image,i.setAttr(e,"id",t),e.onload=function(){r.notice(r.getNode(this),"success",this.src),r.executeLink(this)},e.onerror=function(t){var e=r.getNode(this);e.try<n.try?(e.try=e.try+1,r.appendNode(r.createNode(e.src,e.options,e.notice,e.group,e.try))):r.notice(e,"error",this.src),r.executeLink(this)},o.img=e,o.free=!0,this.pool.push(o)},t.prototype.notice=function(t,e,o){t.notice(e,o)},t.prototype.executeLink=function(t){this.linkHead?(this.setSrc(t,this.linkHead),this.shiftNode()):this.status(t,!0)},t.prototype.getFree=function(){var t,e;for(e=0,t=this.pool.length;e<t;e++)if(this.pool[e].free)return this.pool[e];return null},t.prototype.setSrc=function(t,e){this.status(t,!1),this.setNode(t,e),t.src=e.src},t.prototype.status=function(t,e){var o=i.getAttr(t,"id");this.pool[o].free=e,e&&(this.pool[o].node=null)},t.prototype.setNode=function(t,e){var o=i.getAttr(t,"id");return this.pool[o].node=e,this.pool[o].node===e},t.prototype.getNode=function(t){var e=i.getAttr(t,"id");return this.pool[e].node},t.prototype.load=function(t,e){var n=[],i=null,r=0,s=0,u=function(){return e.once?function(t,e){var o=this.group,n=this.options;o[t].push(e),o.success.length+o.error.length===o.count&&setTimeout(function(){n.success.call(null,o.success,o.error,o.count)},1)}:function(t,e){var o=this.options;setTimeout(function(){o[t].call(null,e)},1)}}(),c={count:0,success:[],error:[]},a=null;for(e=e||{},e.success=e.success||o,e.error=e.error||o,n=n.concat(t),c.count=n.length,s=0,r=n.length;s<r;s++)a=this.createNode(n[s],e,u,c),i=this.getFree(),i?this.setSrc(i.img,a):this.appendNode(a)},t.prototype.info=function(){var t={},e=0,o=0,n=null;for(t.thread={},t.thread.count=this.pool.length,t.thread.free=0,t.task={},t.task.count=0,o=0,e=this.pool.length;o<e;o++)this.pool[o].free&&(t.thread.free=t.thread.free+1);if(n=this.linkHead)for(t.task.count=t.task.count+1;n.next;)t.task.count=t.task.count+1,n=n.next;return t},t.prototype.createNode=function(t,e,o,n,i){var r={};return r.src=t,r.options=e,r.notice=o,r.group=n,r.try=i||0,r},t.prototype.appendNode=function(t){this.linkHead?(this.linkNode.next=t,this.linkNode=t):(this.linkHead=t,this.linkNode=t)},t.prototype.shiftNode=function(){this.linkHead&&(this.linkHead=this.linkHead.next||null)},exports.initImagePool=function(o){return e||(e=new t(o),e.initPool()),{load:function(){e.load.apply(e,arguments)},info:function(){return e.info.call(e)}}},Imagepool});